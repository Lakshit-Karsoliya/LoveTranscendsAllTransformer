import torch


class RoPE:
    def __init__(self,emb_dim,num_heads,seq_len,device='cpu'):
        self.emb_dim = emb_dim
        self.seq_len = seq_len
        self.device = device
        self.head_dim = emb_dim//num_heads

    def precompute_angles(self):
        inv_freq = 1.0 / (10_000 ** (torch.arange(0,self.head_dim//2,device=self.device).float() / (self.head_dim//2) ))
        positions = torch.arange(self.seq_len,device=self.device).float()
        inv_freq = inv_freq.unsqueeze(0) # -> [1,dim//2]
        positions = positions.unsqueeze(0) # -> [1,seq_len]
        angle = torch.matmul(torch.transpose(positions,0,1),inv_freq)
        return angle

class SinosudalPositionalEmbedding:
    """                                                                                                                                       
          ████░░▓█▒▒▓████████████████████████████████████████████████████████████████████████████████████████████████████████████████████          
          █▓▓█░░▒█▒░░▓███▓░▒▓███████████████████████████████████████████████████████████████████████████████████████████████████▓████████          
          ▒ ░█▒ ░▓▒░░▓███░░▒█████████████████████████████████████████████████████████████████████████████████████████████▒▒▓██▓▒▒▓█▓▓████          
          ▓ ░▒▒  ▒▒ ░▓██░░▒▓█████████████████████████████████████████████████████████████████████████████████████████████▓▒▒▓█▓▒▒▒█▒▒████          
          █░░░▓░ ░░░░▒▓▒░▒▓████████████████████████████████████████▓▒░░░░░░░▒▒▓██████████████████▓▓▓▓▓▓▓▓█████████████████▒░▒▓▓▒░▒▓▒░▓█▒▒          
          █▒░░    ░░░░░▒▒▓██████████████████████████████████████▓░░░░░▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████████████▓▒░▒▒▒░▒▒▒▒▓█▒▒          
          █░░░░░░░░░▒▒▒▒▓█████████████████████████████████████▓░░░░░░░░▒▒▒▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░▒░▒▓█          
          █▒░░░░░░░░░░░▒▒▓██▓▓▓▓█████████████████████████████▒ ░   ░░░▒▒▒▒▒▒▒▓▓▓█████▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒ ▒░▒░░   ▒▒▒          
          █▒░░░░░░░░░░░░░░░░░▒▓▓▓▓██████████████████████████▓      ░░░▒▒▒▒▒▒▒▒▒▓▓███████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░▒▓▓▓▓▓▓▓▒▒▓▓░    ░▒          
          █▓░░░░░░░░░░░░░▒▒█████████████████████████████████▓░ ░░░░░░░░░▒▒▒░░▒▒▓▓▓██████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▓█▒░░░▒          
          █▓▒░▒▒▒░░░▒▒▒▓████████████████████████████████████▓░  ░░░▒▒▓▓▓▓▒▒▒▓▓██████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▓▓█▓▒░▒█          
          █▓░░░░░▒▒▒▓███████████████████████████████████████▓▒ ░ ░▓▓▓▓▓▓▓▒░▓█▓▓▓▓███████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▓▒▓▓▓▒▒▓█          
          █▓░░░░░▒▒▓███████████████████████████████████████▓░░  ░░▒▒▒▒▒▒▒▒░▒█▓▒▒▒▓██████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒░░▒▓█          
          █░░░░░▒▒▒▓███████████████████████████████████████▓▒░░░░░░▒▓▓▒▒▒ ░░▒█▓▒▒▒▓▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░▒▒▓▓███          
          ▓▓▓▓▓▓▓████████████████████████████████████████▓▓▓▓▒░░░░▒▒▒░▒▒░▒▒▓█████▓▓█████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████████          
          ▓▓▒▓▓▓▓███████████████████████████████████████▓▓▓▓▓▓▒░░░░░▒▒▒▒░░▒▒▒▓█████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓          
          █▓▒▒▓▓▓██████████████████████████████████████▓▓▓▓▓▓▓▒▒░░░▒▒▒▒▓▓▓▓▓▓███▓▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓▓▓▓███          
          ████████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓███▓███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓▓▓▓▓██          
          ██████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▒░▒▓▒▒▒▒▒▒▒▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████████          
          ███████████████████████████████████████████▓▓▓▓▓▓▓▓▓▒░▒▓▒▒▒▒██████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓█████████          
          ████████████████████▓░    ▒▒▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒███▒▒▒▒▒▓█▓▓████████████████▓▓▒▒▓███████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓█████████          
          ███████████████████▒░░░░░▓▓▓█████████████████████▓▓▓▓▓████▒▒▒▒▒█████████████████████████████████████▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓█████████          
          ███████████████████░░ ░▒▓▓▓█████████████████████████▓█████▒▓▓█████████████████████████████████████████▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓█████████          
          ██████████████████████████▓██████████████████████████████▓▓███████████████████████████████████████████████▓▒▒▒▒▒▒▒▒▒▒▓█████████          
          █████████████████████████████▓█████████████████████▓███▓███████████▓▓▓▓█▓▒▓████████████████████████████████████████▓▓██████████          
          ████████████████████████████████████████████████████████████████▓▓▓▓▓▓▓▓▓▒▓████████████████████████████████████████████████████          
          ████████████████████████████████████████████████▓▓▓█████▓▓██████▓▓▓▓▓▓▓▓█▒▓████████████████████████████████████████████████████          
          █████████████████████████████████████████████████████████████▓███▓███▓▓▓▓▒▓████▓███████████████████████████████████████████████          
          ▒▒▒▓█████████████████████████████████████████████████████▓███████▓▓▓█████▓▓███▓████████████████████████████████████████████████          
          ████████████████████████████████████████████▓▒██▓▒▒▓█▓▒▒▓██▓▒▒▓█▒█▓█▒██▓▓▓▒▒▒▒▓▒▒▒▓████████████████████████████████████████▓▓▓▓          
          ███████████▓▓██████████████████████████████▓▒▓░█▒▒▒░█▓▒▒▓█░▓▓█▒▒░███░██▓▒█▓▒▓▓▒▒▒▓████████████████████████████████▓▒▒▒▒░░░░░▒▒▒          
          ███████████▓▓▓█▓▒▒░▓███████████████████████▒██▓▒▒▒▒▒▓▒▒▒▒█▓▒▒▒▒▓░▒▒▓▓▒▒▒██▓▒▓█▒▒▒▒▓█████████████████████████████▒▒▒▒▒░░░░░▒▒▒▓▓          
          ████████████▓▓███▒▓▓█████████████████████████████████████████▓▓▓▓▓███▓█████▓███████████████████████████████████▒▒▒▒▒░░░░▒▒▒▒▓▓▓          
          ███████████████████████████▓▓▓▓▓███████▓▓▓███▓▓██████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓██████▓▓▓▓▓███████▓▓▓███████████▒▒▒▒▒▒░░░▒▒▒▒▓▓▓█          
          ████████████████████████▒    ░░   ░███▒  ▒██▒   ░█▓▓█▒  ░██▓    ░░░░░░░▓██     ▓███▒     ██████░    ▓█████████▒▒▒▒▒░░░▒▒▒▒▓▓▓██          
          ███████████████████████   ▒█████▓░░▒██▒  ▒██▒     ▓██▒  ░██▓   ▓██████████     ░██▓  ░   █████▒  ░   ▓███████▓▒▒▒▒▒░░░▒▒▒▒▓████          
          ██████████████████████▓  ░████████████▒  ▒██▒  ▒░  ░█▓  ░██▓          ░███   ▓  ▒█░  ▓   ████▒  ░█▓   ▓██████▓▒▒▒▒░░░▒▒▒▒▓▓████          
          ██████████████████████▓   ████████████▒  ▒██▒  ▒█▒   ▒  ▒██▓   ███████████   █▒  ▓  ▓▓   ███▒   ▓▓▓▒   ███████▒▒▓▒░░▒▒▒▒▒▓█████          
          ███████████████████████░  ░█████░  ░██▒  ▒██▒  ▒███░    ▒██▓   ▓▓█████████   █▓    ░█▓   ██▒            ██████▓▓▓▒░░▒▒▒▒▓▓█████          
          █████████████████████████░        ▓███▒  ▒██▒  ▒████▒   ▒██▓           ▒██   ██▒   ▓██   █▓   ▓██████▒   █████▓▓▓▒░▒▒▒▒▓▓▓█████          
          ██████████████████████████████████████████████████████████████████████████████████████████████████████████████▓▓▓▓▒▒▓▓▓▓▓██████          
          ██████████████████████████████████████████████████████████████████████████████████████████████████████████████▓▓▓▓▒▒▓▓▓████████                                                                                                                                         
    """
    def __init__(self):...
